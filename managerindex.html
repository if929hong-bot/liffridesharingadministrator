<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>車隊管理員登入</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #f0f2f5;
      font-family: "Microsoft JhengHei", sans-serif;
    }
    .login-card {
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
  <div class="login-card bg-white rounded-lg p-8 w-full max-w-md">
    <h2 class="text-2xl font-bold text-center mb-8 text-gray-800">車隊管理員登入</h2>
    
    <!-- 登入表單 -->
    <form id="managerLoginForm">
      <div class="mb-4">
        <label class="block text-gray-700 mb-2" for="loginAccount">登入帳號</label>
        <input 
          type="text" 
          id="loginAccount" 
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
          placeholder="請輸入您的登入帳號"
          required
        >
      </div>
      <div class="mb-6">
        <label class="block text-gray-700 mb-2" for="loginPassword">登入密碼</label>
        <input 
          type="password" 
          id="loginPassword" 
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
          placeholder="請輸入您的登入密碼"
          required
        >
      </div>
      <button 
        type="submit" 
        class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition duration-200"
      >
        登入系統
      </button>
    </form>

    <!-- 忘記密碼按鈕（可選，基於信箱重置） -->
    <div class="text-center mt-4">
      <button id="forgotPasswordBtn" class="text-blue-600 hover:underline text-sm">
        忘記密碼？
      </button>
    </div>
  </div>

  <script>
    // 儲存鍵名（與後台保持一致）
    const FLEET_ADMIN_KEY = 'fleetAdminList';

    // 1. 登入驗證邏輯
    document.getElementById('managerLoginForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // 獲取輸入的帳號密碼
      const inputAccount = document.getElementById('loginAccount').value.trim();
      const inputPassword = document.getElementById('loginPassword').value.trim();
      
      // 讀取已審核的管理員列表
      const adminList = JSON.parse(localStorage.getItem(FLEET_ADMIN_KEY) || '[]');
      
      // 驗證帳號密碼
      const validAdmin = adminList.find(item => 
        item.account === inputAccount &&  // 匹配帳號
        item.password === inputPassword && // 匹配密碼
        item.status === 'active'          // 狀態必須是正常（未停權）
      );
      
      if (validAdmin) {
        // 登入成功：儲存當前登入用戶信息，跳轉到管理員首頁
        localStorage.setItem('currentManager', JSON.stringify({
          id: validAdmin.id,
          fleetName: validAdmin.fleetName,
          name: validAdmin.managerName,
          account: validAdmin.account
        }));
        alert('登入成功！');
        // 跳轉到車隊管理員的功能頁（替換為實際的管理頁面路徑）
        window.location.href = 'manager-dashboard.html'; // 請替換為真實的後台頁面
      } else {
        // 登入失敗：提示錯誤
        alert('登入失敗！請檢查：\n1. 帳號密碼是否正確\n2. 帳號是否已通過審核\n3. 帳號是否被停權');
      }
    });

    // 2. 忘記密碼功能（基於信箱重置，可選）
    document.getElementById('forgotPasswordBtn').addEventListener('click', function() {
      const inputAccount = prompt('請輸入您的登入帳號，我們將發送密碼重置郵件到您的信箱：');
      if (!inputAccount) return;
      
      const adminList = JSON.parse(localStorage.getItem(FLEET_ADMIN_KEY) || '[]');
      const admin = adminList.find(item => item.account === inputAccount);
      
      if (admin && admin.email) {
        // 真實專案中這裡會發送郵件，這裡模擬提示
        alert(`已發送密碼重置連結到您的信箱：${admin.email}\n（測試模式：您的密碼是 ${admin.password}）`);
      } else {
        alert('未找到該帳號，或該帳號未綁定信箱！');
      }
    });

    // 3. 防止重複登入（若已登入直接跳轉）
    window.addEventListener('load', function() {
      const currentManager = JSON.parse(localStorage.getItem('currentManager') || 'null');
      if (currentManager) {
        alert(`您已登入：${currentManager.fleetName} - ${currentManager.name}`);
        window.location.href = 'manager-dashboard.html';
      }
    });
  </script>
</body>
</html>