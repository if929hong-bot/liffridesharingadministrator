<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>搭車自由 - 乘客叫車平台</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet'>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#00A86B',    // 乘客主色
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .input-field {
        @apply w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none transition-all;
      }
      .input-field-primary {
        @apply focus:ring-2 focus:ring-primary/50 focus:border-primary;
      }
      .btn-primary {
        @apply bg-primary text-white py-3 px-6 rounded-lg font-medium transition-all duration-300 hover:bg-primary/90 active:scale-95 shadow-md w-full;
      }
      .map-container {
        @apply w-full h-48 rounded-lg border border-gray-200 mt-2;
      }
    }
  </style>
</head>
<body class="bg-gray-50 font-sans min-h-screen">
  <!-- 頁頭導航（移除角色入口） -->
  <header class="w-full max-w-6xl mx-auto px-4 py-6">
    <div class="flex items-center justify-between flex-wrap">
      <div class="flex items-center">
        <!-- 修正：錯誤的圖標標籤 <<<i> 改為 <<i> -->
        <<i class="fa fa-car text-primary text-2xl mr-2"></</i>
        <h1 class="text-xl font-bold">搭車自由</h1>
      </div>
      <!-- 刪除右上角的角色按鈕 -->
    </div>
  </header>

  <main class="w-full max-w-6xl mx-auto px-4 pb-12">
    <!-- 只保留乘客叫車區塊 -->
    <section id="passenger-section" class="max-w-md mx-auto">
      <div class="bg-white rounded-xl shadow-md p-8 text-center">
        <h2 class="text-2xl font-bold text-primary mb-2">乘客叫車</h2>
        <p class="text-gray-600 text-sm mb-6">無需登錄，立即叫車</p>
        
        <form id="passenger-order-form" class="space-y-4">
          <div class="text-left">
            <label class="block text-sm font-medium text-gray-700 mb-1">姓名</label>
            <input type="text" class="input-field input-field-primary" placeholder="輸入您的姓名" required>
          </div>
          <div class="text-left">
            <label class="block text-sm font-medium text-gray-700 mb-1">電話</label>
            <input type="tel" class="input-field input-field-primary" placeholder="輸入您的聯絡電話" required>
          </div>
          
          <!-- 上車地點 -->
          <div class="text-left">
            <label class="block text-sm font-medium text-gray-700 mb-1">上車地點</label>
            <input type="text" class="input-field input-field-primary" id="pickup-location" placeholder="點擊地圖選擇位置" required>
            <div id="pickup-map" class="map-container"></div>
          </div>
          
          <!-- 下車地點 -->
          <div class="text-left">
            <label class="block text-sm font-medium text-gray-700 mb-1">下車地點</label>
            <input type="text" class="input-field input-field-primary" id="dropoff-location" placeholder="點擊地圖選擇位置" required>
            <div id="dropoff-map" class="map-container"></div>
          </div>
          
          <div class="text-left">
            <label class="block text-sm font-medium text-gray-700 mb-1">乘客人數</label>
            <select class="input-field input-field-primary" required>
              <option value="1">1 人</option>
              <option value="2">2 人</option>
              <option value="3">3 人</option>
              <option value="4+">4 人以上</option>
            </select>
          </div>
          
          <button type="submit" class="btn-primary">
            我要叫車
          </button>
        </form>
      </div>
    </section>
  </main>

  <footer class="w-full text-center text-gray-500 text-sm py-6 border-t border-gray-200">
    <p>© 2025 搭車自由 LIFF 應用 | 透過 LINE Developer 平台提供服務</p>
    <div class="mt-2 flex justify-center space-x-4">
      <a href="#" class="hover:text-primary transition-colors">關於我們</a>
      <a href="#" class="hover:text-primary transition-colors">服務條款</a>
      <a href="#" class="hover:text-primary transition-colors">聯絡我們</a>
    </div>
  </footer>

  <script>
    const APP = {
      mapboxToken: 'pk.eyJ1IjoiaWY5Mjlob25nIiwiYSI6ImNtamQxczU2cjAweDMzZnM1Z3BvY2JkejgifQ.q-GNcs0rqWrZ3HtjhmysEQ',
      init: function() {
        this.initPassengerMap();
        this.initFormHandlers();
      },
      
      initPassengerMap: function() {
        if (!mapboxgl) return;
        
        mapboxgl.accessToken = this.mapboxToken;
        const taichungCenter = [120.6704, 24.1319];

        // 上車地圖
        const pickupMap = new mapboxgl.Map({
          container: 'pickup-map',
          style: 'mapbox://styles/mapbox/streets-v12',
          center: taichungCenter,
          zoom: 14,
          attributionControl: false
        });
        pickupMap.addControl(new mapboxgl.AttributionControl({ compact: true }));
        pickupMap.on('click', (e) => this.getAddressFromLngLat(e.lngLat.lng, e.lngLat.lat, 'pickup-location'));

        // 下車地圖
        const dropoffMap = new mapboxgl.Map({
          container: 'dropoff-map',
          style: 'mapbox://styles/mapbox/streets-v12',
          center: taichungCenter,
          zoom: 14,
          attributionControl: false
        });
        dropoffMap.addControl(new mapboxgl.AttributionControl({ compact: true }));
        dropoffMap.on('click', (e) => this.getAddressFromLngLat(e.lngLat.lng, e.lngLat.lat, 'dropoff-location'));
      },
      
      getAddressFromLngLat: function(lng, lat, inputId) {
        fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${lng},${lat}.json?access_token=${this.mapboxToken}&language=zh-TW`)
          .then(res => res.json())
          .then(data => {
            const address = data.features[0]?.place_name || `(${lat.toFixed(4)}, ${lng.toFixed(4)})`;
            document.getElementById(inputId).value = address;
          })
          .catch(err => {
            console.error('地址解析失敗:', err);
            document.getElementById(inputId).value = `(${lat.toFixed(4)}, ${lng.toFixed(4)})`;
          });
      },
      
      initFormHandlers: function() {
        // 乘客叫車表單提交
        const passengerForm = document.getElementById('passenger-order-form');
        if (passengerForm) {
          passengerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            window.location.href = 'passenger-order.html';
          });
        }
      }
    };

    // 頁面加載完成後初始化
    document.addEventListener('DOMContentLoaded', () => {
      APP.init();
    });
  </script>
</body>
</html>