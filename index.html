<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>搭車自由 - 乘客叫車</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#00A86B',
            secondary: '#1E40AF',
          },
        },
      }
    }
  </script>

  <style type="text/tailwindcss">
    @layer utilities {
      .input-field { @apply w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50; }
      .btn-primary { @apply bg-primary text-white py-3 px-6 rounded-lg font-medium transition-all duration-300 hover:bg-primary/90 active:scale-95 shadow-md w-full; }
      .card { @apply bg-white rounded-xl shadow-md p-8 max-w-md mx-auto mt-8; }
    }
  </style>
</head>
<body class="bg-gray-50 font-sans min-h-screen">
  <div class="card">
    <div class="text-center mb-6">
      <i class="fa fa-car text-primary text-5xl mb-2"></i>
      <h1 class="text-2xl font-bold">搭車自由 - 乘客叫車</h1>
    </div>

    <form id="passenger-form" class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">姓名</label>
        <input type="text" id="name" class="input-field" placeholder="輸入您的姓名" required>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">電話</label>
        <input type="tel" id="phone" class="input-field" placeholder="輸入聯繫電話" required>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">上車地點</label>
        <input type="text" id="pickup" class="input-field" placeholder="輸入上車地點（如XX路XX號）" required>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">下車地點</label>
        <input type="text" id="dropoff" class="input-field" placeholder="輸入下車地點（如XX路XX號）" required>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">備註（可選）</label>
        <textarea id="remark" class="input-field" rows="2" placeholder="輸入額外需求（如行李數量）"></textarea>
      </div>
      <button type="submit" class="btn-primary">
        <i class="fa fa-paper-plane mr-2"></i> 提交訂單
      </button>
    </form>
  </div>

  <script>
    // Firebase配置（替換為你的真實配置）
    const firebaseConfig = {
      apiKey: "你的API Key",
      authDomain: "你的Auth Domain",
      databaseURL: "你的Database URL",
      projectId: "你的Project ID",
      storageBucket: "你的Storage Bucket",
      messagingSenderId: "你的Sender ID",
      appId: "你的App ID"
    };
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.database();

    // 獲取當前車隊ID（從URL參數讀取）
    let currentTeamId = '';
    function getCurrentTeamId() {
      const urlParams = new URLSearchParams(window.location.search);
      currentTeamId = urlParams.get('team') || '';
      // 沒有車隊ID則提示
      if (!currentTeamId) {
        alert('請透過正確的車隊連結進入！');
        return false;
      }
      return true;
    }

    // 提交訂單
    document.getElementById('passenger-form').addEventListener('submit', (e) => {
      e.preventDefault();
      
      // 檢查車隊ID
      if (!getCurrentTeamId()) return;

      // 獲取表單數據
      const formData = {
        name: document.getElementById('name').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        pickup: document.getElementById('pickup').value.trim(),
        dropoff: document.getElementById('dropoff').value.trim(),
        remark: document.getElementById('remark').value.trim(),
        teamId: currentTeamId, // 綁定車隊ID
        status: '待接單',
        createTime: new Date().toLocaleString('zh-TW'),
        orderId: 'ORD-' + Date.now() // 生成訂單ID
      };

      // 存入Firebase
      db.ref('activeOrders').push(formData).then(() => {
        alert('訂單提交成功！司機將很快聯繫您');
        document.getElementById('passenger-form').reset();
      }).catch(err => {
        console.error('提交訂單失敗:', err);
        alert('訂單提交失敗，請稍後重試');
      });
    });

    // 初始化
    document.addEventListener('DOMContentLoaded', () => {
      getCurrentTeamId();
    });
  </script>
</body>
</html>