<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>區域管理 - LINE多元化搭車管理員</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#00C300',
                        secondary: '#00A600',
                        'text-dark': '#333333',
                        'text-light': '#666666',
                        'card-bg': '#FFFFFF',
                        'border-color': '#E5E7EB',
                        'hover-bg': '#F3F4F6'
                    },
                    boxShadow: {
                        'card': '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)',
                    }
                }
            }
        }
    </script>
    <style>
        /* 全域樣式優化 */
        body {
            background-color: #F9FAFB;
            font-family: "Microsoft JhengHei", sans-serif;
        }
        
        /* 未登錄提示遮罩 */
        .unauth-overlay {
            position: fixed;
            inset: 0;
            background: white;
            z-index: 999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        /* 響應式側邊欄 */
        .sidebar {
            width: 220px;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            background-color: white;
            border-right: 1px solid #E5E7EB;
            padding-top: 60px;
            transition: transform 0.3s ease;
            z-index: 90;
        }
        
        /* 響應式主內容區 */
        .main-content {
            margin-left: 220px;
            padding: 60px 24px 24px;
            transition: margin-left 0.3s ease;
        }
        
        /* 頁首樣式優化 */
        .header {
            height: 60px;
            position: fixed;
            top: 0;
            left: 220px;
            right: 0;
            background-color: white;
            border-bottom: 1px solid #E5E7EB;
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 80;
            transition: left 0.3s ease;
        }
        
        /* 區域卡片樣式簡化 */
        .area-item {
            background-color: white;
            border: 1px solid #E5E7EB;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        
        /* 響應式适配 (平板/手機) */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
            .header {
                left: 0;
            }
            .sidebar-mobile-open {
                transform: translateX(0);
            }
            .mobile-menu-btn {
                display: block !important;
            }
        }
        
        /* 隱藏默認的手機菜單按鈕 (桌面端) */
        .mobile-menu-btn {
            display: none;
        }
    </style>
    <!-- 植入通用穩定性工具類 -->
    <script>
        /**
         * 全局工具類 - 提升網站穩定性、統一處理通用邏輯
         * 適用於所有車隊管理系統頁面
         */
        const Utils = {
            // ========== 基礎工具方法 ==========
            safeParseJSON(str) {
                try {
                    return str && str !== 'null' && str !== 'undefined' ? JSON.parse(str) : null;
                } catch (e) {
                    console.error('JSON解析失敗:', e, '原始字串:', str);
                    return null;
                }
            },

            safeGetElement(id) {
                const el = document.getElementById(id);
                if (!el) console.warn(`[Utils] 元素#${id}不存在`);
                return el;
            },

            validateNumber(value, allowZero = false) {
                const trimmed = value.trim();
                if (!/^\d+$/.test(trimmed)) return false;
                if (!allowZero && Number(trimmed) <= 0) return false;
                return true;
            },

            // ========== 本地存儲管理（帶過期機制） ==========
            Storage: {
                set(key, data, expireHours = 24) {
                    try {
                        const value = JSON.stringify(data);
                        localStorage.setItem(key, value);
                        if (expireHours) {
                            const expireTime = Date.now() + expireHours * 60 * 60 * 1000;
                            localStorage.setItem(`${key}_expire`, expireTime);
                        }
                    } catch (e) {
                        console.error('[Storage] 儲存失敗:', e);
                        alert('本地存儲空間不足，無法保存數據！');
                    }
                },

                get(key) {
                    try {
                        const expireTime = localStorage.getItem(`${key}_expire`);
                        if (expireTime && Date.now() > Number(expireTime)) {
                            this.remove(key);
                            return null;
                        }
                        return Utils.safeParseJSON(localStorage.getItem(key));
                    } catch (e) {
                        console.error('[Storage] 讀取失敗:', e);
                        return null;
                    }
                },

                remove(key) {
                    localStorage.removeItem(key);
                    localStorage.removeItem(`${key}_expire`);
                },

                clearAllFleetData() {
                    const keys = Object.keys(localStorage);
                    keys.forEach(key => {
                        if (key.includes('fleet') || key.includes('admin') || key.includes('price') || key.includes('finance')) {
                            this.remove(key);
                        }
                    });
                }
            },

            // ========== 登錄狀態管理 ==========
            Auth: {
                KEYS: {
                    LOGGED_IN: 'loggedInFleetAdmin',
                    BACKUP: 'currentFleetAdmin',
                    EXPIRE: 'adminExpireTime'
                },

                checkLoginStatus() {
                    let adminData = Utils.Storage.get(Utils.Auth.KEYS.LOGGED_IN);
                    if (!adminData) {
                        adminData = Utils.Storage.get(Utils.Auth.KEYS.BACKUP);
                    }

                    const hasValidAccount = adminData && (
                        adminData.帳號 || adminData.username || adminData.account || adminData.phone
                    );

                    if (!hasValidAccount) {
                        Utils.Storage.clearAllFleetData();
                        return false;
                    }

                    Utils.Storage.set(Utils.Auth.KEYS.LOGGED_IN, adminData, 24);
                    return true;
                },

                redirectToLogin() {
                    alert('登錄已過期或未登錄，請重新登入！');
                    window.location.href = 'manager-login.html';
                },

                logout() {
                    Utils.Storage.clearAllFleetData();
                    window.location.href = 'manager-login.html';
                }
            },

            // ========== UI增強方法 ==========
            showLoading(el, text = '加載中...') {
                if (!el) return;
                el.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #666;">
                        <i class="fa fa-spinner fa-spin mr-2"></i>${text}
                    </div>
                `;
            },

            showEmptyData(el, text = '暫無數據', colspan = 1) {
                if (!el) return;
                if (el.tagName === 'TBODY') {
                    el.innerHTML = `
                        <tr>
                            <td colspan="${colspan}" style="padding: 30px; text-align: center; color: #666;">
                                ${text}
                            </td>
                        </tr>
                    `;
                } else {
                    el.innerHTML = `
                        <div style="padding: 30px; text-align: center; color: #666;">
                            ${text}
                        </div>
                    `;
                }
            },

            validateFormNumbers(inputs) {
                let isValid = true;
                inputs.forEach(input => {
                    const label = input.previousElementSibling?.textContent || input.name || '該項';
                    const value = input.value;

                    if (!Utils.validateNumber(value)) {
                        alert(`${label}只能填大於0的數字！`);
                        input.focus();
                        isValid = false;
                        return false;
                    }
                });
                return isValid;
            }
        };
    </script>
</head>
<body>
    <!-- 未登錄提示遮罩（未登錄時顯示） -->
    <div id="unauthOverlay" class="unauth-overlay hidden">
        <div class="text-center max-w-md">
            <i class="fa fa-exclamation-circle text-4xl text-red-500 mb-4"></i>
            <h2 class="text-2xl font-bold text-text-dark mb-2">未登錄或登錄已過期</h2>
            <p class="text-text-light mb-6">請先完成車隊管理員登錄</p>
            <a href="manager-login.html" class="inline-block py-3 px-6 bg-primary text-white rounded-lg font-medium hover:bg-secondary transition-all">
                返回登入頁面
            </a>
        </div>
    </div>

    <!-- 頁首 (保留基礎結構，移除交互按鈕) -->
    <div class="header">
        <div class="flex items-center gap-3">
            <!-- 手機端菜單按鈕 -->
            <button class="mobile-menu-btn text-text-dark hover:text-primary" id="mobileMenuBtn">
                <i class="fa fa-bars text-lg"></i>
            </button>
            <h1 class="text-lg font-bold text-text-dark">LINE多元化搭車管理員系統</h1>
        </div>
        
        <div class="flex items-center space-x-4">
            <!-- 管理員信息 (保留基礎顯示) -->
            <div class="flex items-center space-x-2">
                <img src="https://via.placeholder.com/32" alt="管理員頭像" class="w-8 h-8 rounded-full border-2 border-primary">
                <span class="text-text-dark" id="managerName">管理員</span>
            </div>
        </div>
    </div>

    <!-- 側邊菜單（修正所有連結，與要求完全一致） -->
    <div class="sidebar" id="sidebar">
        <nav class="space-y-1 px-4">
            <a href="admin-dashboard.html" class="block py-2 px-3 rounded-md text-text-dark hover:bg-gray-100 transition-all flex items-center">
                <i class="fa fa-home mr-2 text-sm"></i>
                <span>首頁</span>
            </a>
            <a href="admin-area.html" class="block py-2 px-3 rounded-md bg-primary text-white font-medium flex items-center">
                <i class="fa fa-map-marker mr-2 text-sm"></i>
                <span>區域管理</span>
            </a>
            <a href="admin-driver.html" class="block py-2 px-3 rounded-md text-text-dark hover:bg-gray-100 transition-all flex items-center">
                <i class="fa fa-car mr-2 text-sm"></i>
                <span>司機管理</span>
            </a>
            <a href="admin-order.html" class="block py-2 px-3 rounded-md text-text-dark hover:bg-gray-100 transition-all flex items-center">
                <i class="fa fa-shopping-cart mr-2 text-sm"></i>
                <span>訂單管理</span>
            </a>
            <a href="admin-finance.html" class="block py-2 px-3 rounded-md text-text-dark hover:bg-gray-100 transition-all flex items-center">
                <i class="fa fa-money mr-2 text-sm"></i>
                <span>財務管理</span>
            </a>
            <a href="admin-report.html" class="block py-2 px-3 rounded-md text-text-dark hover:bg-gray-100 transition-all flex items-center">
                <i class="fa fa-bar-chart mr-2 text-sm"></i>
                <span>報表統計</span>
            </a>
            <a href="javascript:void(0)" class="block py-2 px-3 rounded-md text-text-dark hover:bg-gray-100 transition-all flex items-center mt-4" id="logoutLink">
                <i class="fa fa-sign-out mr-2 text-sm"></i>
                <span>退出登入</span>
            </a>
        </nav>
    </div>

    <!-- 主內容區 (只保留區域名稱，清空所有其他數據/按鈕) -->
    <div class="main-content">
        <!-- 頁面標題區 (簡化顯示) -->
        <div class="mb-6">
            <h2 class="text-xl font-bold text-text-dark">區域管理</h2>
        </div>

        <!-- 區域列表 (只保留各地區名稱，移除所有數據/按鈕/交互) -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" id="areaList">
            <!-- 台北市 -->
            <div class="area-item">
                <h3 class="font-medium text-text-dark text-lg">台北市</h3>
            </div>

            <!-- 新北市 -->
            <div class="area-item">
                <h3 class="font-medium text-text-dark text-lg">新北市</h3>
            </div>

            <!-- 桃園市 -->
            <div class="area-item">
                <h3 class="font-medium text-text-dark text-lg">桃園市</h3>
            </div>

            <!-- 台中市 -->
            <div class="area-item">
                <h3 class="font-medium text-text-dark text-lg">台中市</h3>
            </div>

            <!-- 台南市 -->
            <div class="area-item">
                <h3 class="font-medium text-text-dark text-lg">台南市</h3>
            </div>

            <!-- 高雄市 -->
            <div class="area-item">
                <h3 class="font-medium text-text-dark text-lg">高雄市</h3>
            </div>
        </div>
    </div>

    <script>
        // 全局常量 - 與manager-login.html同步
        const LOGGED_IN_FLEET_KEY = 'loggedInFleetAdmin';

        // 頁面加載初始化
        window.onload = () => {
            // 第一步：使用工具類檢查登錄狀態（增強穩定性）
            if (!Utils.Auth.checkLoginStatus()) {
                Utils.safeGetElement('unauthOverlay')?.classList.remove('hidden');
                return;
            }
            
            // 初始化手機菜單（基礎顯示）
            initMobileMenu();
            
            // 初始化退出登入（使用工具類增強）
            initLogout();
            
            // 加載管理員名稱（使用工具類安全解析）
            loadManagerName();
        };

        // 加載管理員名稱（使用工具類優化）
        function loadManagerName() {
            const adminInfo = Utils.Storage.get(LOGGED_IN_FLEET_KEY);
            const managerNameEl = Utils.safeGetElement('managerName');
            
            if (adminInfo && managerNameEl) {
                managerNameEl.textContent = adminInfo.username || adminInfo.name || adminInfo.帳號 || '管理員';
            }
        }

        // 初始化手機端菜單（僅基礎顯示切換，增加空值檢查）
        function initMobileMenu() {
            const mobileMenuBtn = Utils.safeGetElement('mobileMenuBtn');
            const sidebar = Utils.safeGetElement('sidebar');
            const mainContent = document.querySelector('.main-content');
            
            if (mobileMenuBtn && sidebar) {
                mobileMenuBtn.addEventListener('click', () => {
                    sidebar.classList.toggle('sidebar-mobile-open');
                });
            }

            // 點擊主內容區關閉手機菜單（增加空值檢查）
            if (mainContent && sidebar) {
                mainContent.addEventListener('click', () => {
                    if (window.innerWidth <= 1024) {
                        sidebar.classList.remove('sidebar-mobile-open');
                    }
                });
            }
        }

        // 初始化退出登入（使用工具類增強，與全局邏輯統一）
        function initLogout() {
            const logoutLink = Utils.safeGetElement('logoutLink');
            if (logoutLink) {
                logoutLink.addEventListener('click', function() {
                    if (confirm('確定要退出登入嗎？')) {
                        // 使用工具類清空所有登錄數據
                        Utils.Auth.logout();
                    }
                });
            }
        }

        // ========== 自動綁定全局退出登錄（工具類增強） ==========
        document.addEventListener('DOMContentLoaded', function() {
            // 雙重保障：統一處理退出登錄按鈕
            const logoutLink = Utils.safeGetElement('logoutLink');
            if (logoutLink) {
                logoutLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (confirm('確定要退出登入嗎？')) {
                        Utils.Auth.logout();
                    }
                });
            }
        });
    </script>
</body>
</html>